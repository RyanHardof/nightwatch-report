<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - Operation Nightwatch</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
</head>
<body>
  <img src="vicpol.png" alt="VicPol Badge" id="dvd-logo" />
  <button class="admin-btn" onclick="logout()">Logout</button>

  <div class="container fade">
    <h1 class="title-logo">
      <img src="vicpol.png" alt="VicPol Logo" class="inline-logo" />
      Admin: Operation Nightwatch
    </h1>

    <label for="search">Filter by Name</label>
    <input type="text" id="search" placeholder="Start typing a name..." />

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Unit</th>
          <th>Callsign</th>
          <th>Report ID</th>
          <th>Charges</th>
          <th>Time</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="submissions">
        <!-- Populated by JS -->
      </tbody>
    </table>
  </div>

  <script>
    if (localStorage.getItem("isAdmin") !== "true") {
      alert("Unauthorized. Redirecting...");
      window.location.href = "index.html";
    }

    let reports = JSON.parse(localStorage.getItem("nightwatchReports") || "[]");

    function renderTable(data) {
      const tbody = document.getElementById("submissions");
      tbody.innerHTML = "";
      data.forEach((entry, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${entry.name}</td>
          <td>${entry.unit}</td>
          <td>${entry.callsign}</td>
          <td>${entry.reportId}</td>
          <td>${entry.charges}</td>
          <td>${entry.time}</td>
          <td><button onclick="deleteEntry(${index})">‚ùå</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function deleteEntry(index) {
      if (!confirm("Are you sure you want to delete this report?")) return;
      reports.splice(index, 1);
      localStorage.setItem("nightwatchReports", JSON.stringify(reports));
      renderTable(reports);
    }

    document.getElementById("search").addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      const filtered = reports.filter(d => d.name.toLowerCase().includes(term));
      renderTable(filtered);
    });

    function logout() {
      localStorage.removeItem("isAdmin");
      window.location.href = "index.html";
    }

    renderTable(reports);

    // --- Bouncing VicPol logo ---
    const dvdLogo = document.getElementById('dvd-logo');
    const colors = ['#00ffff', '#ff00ff', '#ffff00', '#00ff88', '#ff6600'];
    let dx = 1.5, dy = 1.5, x = 100, y = 100;

    function moveLogo() {
      const screenW = window.innerWidth;
      const screenH = window.innerHeight;
      const logoW = dvdLogo.offsetWidth;
      const logoH = dvdLogo.offsetHeight;

      x += dx;
      y += dy;

      let hitEdge = false;
      if (x + logoW >= screenW || x <= 0) {
        dx *= -1;
        hitEdge = true;
      }
      if (y + logoH >= screenH || y <= 0) {
        dy *= -1;
        hitEdge = true;
      }

      if (hitEdge) {
        const color = colors[Math.floor(Math.random() * colors.length)];
        dvdLogo.style.filter = `drop-shadow(0 0 15px ${color})`;
      }

      dvdLogo.style.left = x + 'px';
      dvdLogo.style.top = y + 'px';
      requestAnimationFrame(moveLogo);
    }

    window.addEventListener("DOMContentLoaded", moveLogo);
  </script>
</body>
</html>
